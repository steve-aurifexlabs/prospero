<!doctype html>
<html lang="en">
<head>
    <meta charset="utf8">
    <link rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAICAAAAEAGACoDAAAFgAAACgAAAAgAAAAQAAAAAEAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLU1dPU1dPU1dPU1dPT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NHT1NHT1NHT1NHT1NLT1NLT1NLT1NLT1NLT1NLT1NLT1NHT1NHT1NHT1NHT1NHT1NLU1dPU1dPU1dPU1dPU1dPU1dPT1NHT1NLT1NLT1NLT1NLT1NLT1NHT1NHT1NHV1tLV1tLV1tLV1tLV1tLU1dPU1dPU1dPU1dPU1dPU1dPV1tLV1tLV1tLV1tLV1tLV1tLU1dPV1tTV1tTW19XW19XX2NbU1dHU1dHU1dHU1dHU1dHU1dHV1tLV1tLV1tLU1dHU1dHU1dHU1dHU1dHT1NLT1NLT1NLT1NLT1NLT1NHU1dHU1dHU1dHV1dHU1dHU1dLV1tTV1tXW19bW19bY2dfY2dfU1dHU1dHU1dHU1dHU1dHU1dHU1dHU1dHU1dHS1dTS1NTS1NTS1NTU1dPZ19PV19LP1NDT2NTU2NTR08/Z2NXY19TT08/a2dbQ0c/a3NrZ3OHX2t7Y29/i5Ofg4uLd39/X2NjY19bW1NPX1dTV2NPR1dDS1NTS1NTS1NTT1dPT1dPT1dPT1dPU1dPV09PW1tbb3d3a3d7d3eDh4OPV19fS1NPU1tXS1NTX2djg4N739vP08vDx8Ozt7urq6uXs7Ojf4+Lc3dvU0tHV1NLV1dHS1NDT1dPT1dPT1dPW1dHW1dHW1dHW1dHX1tTZ2dnh4t/o6Ofk4+Ld2tva2NrZ3NzT1dXS19bU1tbd3tz09PLd2M7RzcLc2c3OzMLT0cnq6OHi6ejb393S09HW1NPW1dHX1tLW1dHW1dHW1dHW1dHW1dHW1dHX1tLV1dLf4d3v8Ojn5t7o5t7y7+n18u/r7Oni4+Ph4uLp6efx8OvX08zCvK6zrZ6spZi5tKnb2dLx8u3a4N/X2tjS0tDX1dPW1dHX1tLW1dHW1dHW1dHW1dHW1dHW1dHX1tLV1dPi4+Lp6uLLyr++u7DDv7bIxbzl4dru7ejt7uny7+nh28+0raCppJewqpyzrZ/Uz8fw7+3k5+fX2tnU1tPU0tHW1NPU1NDS1tHW1dHW1dHW1dHU1dPU1dPV1tTV1tTS1NTd4OLz8fDx7eTu6t/l39bPysG7tqzBvrbRzsbOycC8s6WyqZiqppymoJPZ08jx7efs7e3M0NXc3NvX1tXY1tXX1dPS1dDS1tHU1dPU1dPU1dPT1NLT1NLT1NLT1NLU1dTW2Njc3t7g4ODp6efw8O3t7Onh39nFwLispZmtpZiro5apoZSxpZmropXQy8Lx8Ozj4+Xe4efc3uPV2dvR1tXX3djU1NHZ1tPU1tTU1dPU1dPU1dPU1dPU1dPU1dPV1tTT09LX19bY2dfW1tXc3Nzl5uT29fHj4dnCvLKrpJero5alnI+sopWimo3Fv7Pg3NXp5+Tu7evw7vHq7Oza3t3T2dfV2trS1NfT1NLT1NLT1NLW1NPW1NPW1NPW1NPV1NLW1dHa2tbS0tHU1dXZ29zb3d3s7ezg3tm/urClnpGooJOmnZCnn5C3saO3s6i4s6nEv7bGwbni2tTm49z8+/P1+PPm6+rT2NnU1dPU1dPU1dPW1dHW1dHW1dHW1dHV1dDV1dDZ2dXS09LW19fe3+Dl5ubt7OnNysKyraOlnpGnn5Knn5K5tKjd2dDu7OXk4tri3tXPzMC5r6LNxLfVzsPY1s3w8Ovf4d/W19XW19XV1tTV1NDV1NDV1NDV1NDV1dHR0s7W19TV1dTT09Pi4eLx7+/j39a2saerpJiooJKqopW2sKPc2dHy8e3m5ujn6Onu7urz8uvc1s/GwLjFwLfU0Mrs7OXk5uPV1tTV1tTV1tTV1NDV1NDV1NDV1NDU1NHR1dPV19XU1dLf3t7r6urq6OXOxrqooJOupZetpZexqZzUzsP18u7l5ejY2+Pb3uXV2Nri4+Hy9fb09PP7+/j29vTr7OvU2NfU1dPT1NLT1NLW1dHW1dHW1dHW1dHV1M7X1s/X2NbV19fe39/19PDSzMivqqKrpZinoJGsppjMx7zt6eHo6u7a3d3Y3NnV19LV1tPd3tzZ293U1tfU1tfZ29zY2tvS1NXW1dHW1dHW1dHW1dHW1dHW1dHW1dHX1dHX1dLV1tXU1tbp6ujr6OTHwrurpJmvqJurpZa4s6fl4dn59/LZ293W2NjT1tTV1tLU1dPS1NLZ2tnZ2tnY2tnY2tnV19bT1dTW1dHW1dHW1dHV1NDV1NDV1NDV1NDV1NHV09LV1NbY2trx8O7k4dnBvLGtpZeooZKppJbJxrzq6uXp6+nY29vV2NfT1NDT1NDU1dPU09HQ0c3T1NHV1tLS09DS08/T1NDW1dHW1dHV1NDV1NDV1NDV1NDV1NDU09DW1NTZ2dvf4OHs6+nd2tK1r6Omno+imo22safZ19Hq7evh5uXZ2trT09LT1NDT08/T0tDX1dTS08/S08/S08/S08/T1NDU1dHV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NHV09Lh4OHk5OXp5+TTzcavqJ2kno+ppJfKxb7q6eTp6+rR19XW1tTS08/V19LX1tLU0tHW1NPW1tLT08/T08/T1NDT1NDT08/V1NDV1NDV1NDV1NDV1NDV1NDV1NDX1tLQzszj4+Pj4uLt6ufGwLu0q6KloJLJxLrp493u7erg4+HU2tnU1dPT1NHR0szU1M/X1dPS0NDU08/V1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDW1dDT08/c393n6Ojo5uPNx8CupJm6r6PX1Mv29fXh4eHa29nX1dPW1dHW1dHV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NHT1NLb3d3g4uHt6+fX08m1q6HMxbrq5uHr7ezc3t7V1dXX2NXW1dHW1dHW1dHV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDU08/U08/U08/U08/S08/S1dPa3dzg4uDv7enY08q4sabf29T39fDX2dnV19fS1NTS09LW1NDV1NDV1NDV1NDV1NDV1NDU08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/S09DQ09HX2tjh4uDu7Ofg3dXPzMXz8+7f4N7a3dvQ0tLP0dHR09HU08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/U08/V1dDU1dDU1NDb3Nfo6OTt7err7Ofu7+zY2dTc3NrT1NHV1dLT09DU1M7U1M7U1M7U1M7U1M7U1M7U08/U08/U08/U08/U08/U08/U08/U08/U08/V1NDV1NDV1NDV1NDV1c/W1s7V1c3V1tDb3dre4uHc4N7Y2dXY2dPY19LU087V1M/V1dDV1c/V1c/V1c/W1tDW1tDW1tDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1NDV1c/V1c/V1c/V1c/V1c7V1c7V1c/W1dHY1tTY1tXY19XV1c/U1M7V1c/V1c/V1c/U1M7V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c7U1M3U1M7V1NDV09HW09PV1NHV1c/U1M7V1c/V1c/V1c/U1M7V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/U1M/U08/U0tDU08/V1c/U1M7V1c/V1c/V1c/U1M7V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1NDV1NDV1NDV1c/U1M7V1c/V1c/V1c/U1M7V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c/V1c8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==">
    <title>Collaborate | Aurifex Labs</title>

    <!-- <script src="/lib/codemirror/codemirror.js"></script> -->
    <!-- <link rel="stylesheet" href="/lib/codemirror/codemirror.css"> -->
    <!-- <script src="/lib/codemirror/mode/javascript/javascript.js"></script> -->
    <!-- <script src="/lib/codemirror/mode/xml/xml.js"></script> -->
    <!-- <script src="/lib/codemirror/mode/css/css.js"></script> -->
    <!-- <script src="/lib/codemirror/mode/htmlmixed/htmlmixed.js"></script> -->
</head>
<body>

<style>
@font-face {
    font-family: 'Averia Sans Libre';
    font-style: normal;
    font-weight: 400;
    font-display: fallback;
    src: local('Averia Sans Libre Regular'), local('AveriaSansLibre-Regular'), url('averiasanslibre.woff2') format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

body { font-family: 'Averia Sans Libre', sans-serif; }
button { font-family: 'Averia Sans Libre', sans-serif; }
input { font-family: 'Averia Sans Libre', sans-serif; }

body { background-color: rgb(245, 255, 243); }

button {
    padding: 5px;
    margin: 5px;
    background-color: rgb(193, 251, 138);
    border-radius: 5px;
    border: 1px solid #ccc;
}

button:hover {
    background-color: rgb(171, 255, 92);
    cursor: pointer;
}
</style>

<style>
body { padding: 0; margin: 0; }
body { font-size: 100%; }
h2 { margin: 0; }
footer { font-size: 75%; }
footer a { padding: 5px; }
pre { font-family: 'Courier New', monospace}

#main { position: fixed; top: 0px; bottom: 28px; width: 100%; overflow: auto; }
/* #main { background: repeat url(data:image/png;base64,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); } */
footer { position: fixed; bottom: 0px; height: 18px; left: 10px; right: 10px; }
footer { background: repeat url(data:image/png;base64,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); }
footer { outline: 1px dotted #444; }
/* footer { margin-top: 5px; } */

#tabs { position: fixed;  top: 0px; height: 25px; left: 261px; right: 204px; overflow: hidden; }
/* #main-view { position: fixed; top: 25px; bottom: 28px; left: 260px; right: 203px; border: 1px dotted #444; border-top: none; overflow: auto; } */
#main-view { position: fixed; top: 25px; bottom: 28px; left: 260px; right: 203px; border: 1px dotted #444; overflow: auto; }
#main-view { background: repeat url(data:image/png;base64,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); }

#left-panel { background-color: #111; }
#left-panel { background: repeat url(data:image/png;base64,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); }
#right-panel { background-color: #555; }
#right-panel { background: repeat url(data:image/png;base64,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); }

#left-panel { position: fixed; top: 18px; bottom: 28px; left: 0px; width: 250px; outline: 1px dotted #444; overflow: auto; white-space: nowrap; }
#right-panel { position: fixed; top: 18px; bottom: 28px; right: 0px; width: 193px; outline: 1px dotted #444; overflow: auto; }
#center-panel { position: fixed; left: 200px; right: 200px; height: 100%; overflow: auto; }
#status-bar { position: fixed; right: 500px; font-size: 14px; }

#tabs > * { cursor: pointer; display: inline; white-space: nowrap; overflow: hidden; }
#tabs > * { font-size: 16px; padding: 5px; margin: 0px; }
#tabs > * { border-right: 1px solid #444; background: #ddd; color: #444 }
/* #tabs > *.selected { background: #ddd; color: #222; } */
#tabs > *.selected { cursor: default; background: repeat url(data:image/png;base64,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); }
#tabs > * > span { display: inline-block; width: 222px; overflow: hidden; }
#tabs > * > a { cursor: pointer; padding: 0 2px; font-size: 14px; position: relative; top: -5px; right: -4px; }

#left-panel { font-family: 'Courier New', monospace; font-size: 90%; }
#left-panel pre { padding: 5px; margin: 0px; cursor: pointer; }

.file.selected { background: #444; }

video {
    width: 100%;
    max-height: 100%;
    padding: 0;
    margin: 0;
}

video.preview {
    cursor: pointer;
}

#more-tabs {
    font-size: 90%;
    background-color: #fff;
    color: #222;
    position: fixed;
    top: 2px;
    right: 205px;
    padding: 0 6px;
    border-radius: 8px;
    display: none;
}

#offline { color: #666; }
#invited { color: #888; }

#left-panel:hover {
    overflow-x: visible;
}

#left-panel > :hover {
    background-color: #eee;
    overflow-x: visible;
}

#context-menu {
    display: none;
    position: fixed;
    background-color: #fff;
    border: 1px solid #888;
    border-radius: 5px;
    font-size: 90%;
    min-width: 200px;
}

#context-menu > p {
    padding: 6px;
    margin: 4px 0;
    cursor: pointer;
}

#context-menu > p:not(.disabled):hover {
    background-color: #eee;
}

#context-menu > .disabled {
    cursor: default;
}

#context-menu hr {
    width: 100%;
    border-top: none;
    border-bottom: 1px dotted #aaa;
    margin: 0;
    padding: 0;
}

.editor .code pre {
    display: inline;
}
</style>

<style>
    .editor {
        /* background-color: #fff; */
        background-color: #eee;
        width: 100%;
        line-height: 21px;
    }

    .editor .code {
        padding-left: 5px;
        padding-top: 20px;
    }

    .editor .code span {
        margin-top: 1px;
    }

    .editor .linenos {
        background-color: #ddd;
        color: #777;
        padding-top: 20px;
    }

    .editor .linenodiv > pre {
        margin-top: -7px;
        padding-right: 10px;
        padding-left: 10px;
    }

    .editor .on {
        /* border-left: 3px solid #444; */
        border-left: 4px solid #444;
        /* border-left: 3px solid #44f; */
        margin-left: -4px;
        /* padding-left: -3px; */
        padding-top: 9px;
        margin-top: -9px;
        padding-bottom: 8px;
        margin-bottom: -8px;
    }
    .editor .off {
        border-left: unset;
        margin-left: 0;
    }
    
    .editor .other {
        /* border-left: 3px solid #444; */
        border-left: 4px solid #22f;
        /* border-left: 3px solid #44f; */
        margin-left: -4px;
        /* padding-left: -3px; */
        padding-top: 9px;
        margin-top: -9px;
        padding-bottom: 8px;
        margin-bottom: -8px;
    }
    

    .editor .p {
        color: #444;
    }
    .editor .cp {
        color: #888;
    }
    .editor .o {
        color: #333;
    }
    .editor .s {
        color: #832;
    }
    .editor .s1 {
        color: #832;
    }
    .editor .s2 {
        color: #832;
    }
    .editor .sx {
        color: #832;
    }
    .editor .mh {
        color: #663;
    }
    .editor .mi {
        color: #663;
    }
    .editor .k {
        color: #364;
    }
    .editor .kt {
        color: #363;
    }
    .editor .kc {
        color: #252;
    }
    .editor .kn {
        color: #382;
    }
    .editor .kd {
        color: #262;
    }
    .editor .n {
        color: #238;
    }
    .editor .nb {
        color: #348;
    }
    .editor .nx {
        color: #337;
    }
    .editor .nn {
        color: #327;
    }
    .editor .nc {
        color: #348;
    }
    .editor .nt {
        color: #238;
    }
    .editor .na {
        color: #238;
    }
    .editor .c {
        color: #bbb;
    }
    .editor .c1 {
        color: #bbb;
    }
    
</style>

<!-- <nav><a href="/">Aurifex Labs</a></nav> -->
<div id="main">
    <a style="float: left; font-size: 75%; padding: 0 5px;" href="/teams">Switch Teams</a>
    <a style="float: left; font-size: 75%; padding: 0 5px;" href="/teams">Settings</a>
    <a style="float: right; font-size: 75%; padding: 0 5px;" href="/account">Account</a>
    <div id="left-panel"></div>

    <div id="center-panel">
        <div id="tabs"></div>
        <div id="main-view"></div>
    </div>
    
    <div id="right-panel">
        <!-- <a style="float: right; padding: 5px;" href="/teams">Switch Teams</a> -->
        <!-- <a style="padding: 5px;" href="/teams">Switch Teams</a> -->
        <!-- <a style="padding: 5px;" href="/teams">Account</a> -->
        <!-- <br> -->
        <!-- <br> -->
        <!-- <button>Switch Teams</button> -->
        <!-- <button>Account</button> -->
        <p style="font-size: 75%; margin: 1px; text-decoration: underline;">Online</p>
        <div style="margin: 5px; border-radius: 10px; border: solid 5px #222; background-color: #fff;">
            <p name="your-email" style="margin: 0; padding-left: 3px; overflow: hidden; white-space: nowrap; border-bottom: solid 1px #ddd;"></p>
            <button name="share-video" type="click">Share camera / mic</button>
            <button name="share-screen" type="click">Share screen</button>
            <!-- <button name="share-screen" type="click">CLI</button> -->
            <video style="display: none;" name="local-video" class="preview" autoplay muted></video>
            <video style="display: none;" name="local-screen" class="preview" autoplay muted></video>
        </div>
        <!-- <br> -->
        <div id="offline"></div>
        <div id="invited"></div>
        <!-- <form style="display: none;"> -->
        <p style="font-size: 75%; margin: 1px; text-decoration: underline;">Invite</p>
        <form name="invite">
            <input style="width: 50%; margin: 5px;" type="text" name="email" autocomplete="email" autofocus placeholder="Email">
            <button>Invite</button>
            <p style="font-size: 90%; margin: 0 15px;" name="message"></p>
        </form>
    </div>
</div>

<footer>
        <span id="status-bar">Loading...</span>
        <span style="position: fixed; right: 35px;">
            <a href="/">Home</a>
            <!-- <a href="/content">Content</a> -->
            <a href="/terms-of-service">Terms</a>
            <a href="/privacy-policy">Privacy</a>
            <a href="mailto:contact@aurifexlabs.com">Contact</a>
            <span>Copyright 2019 Aurifex Labs LLC</span>
        </span>
        <img style="position: fixed; right: 10px;" src="data:image/jpeg;base64,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">
</footer>

<div id="more-tabs"><span>0</span> more</div>
<div id="context-menu"></div>


<script>
    var clipboard
    var openFolders = []

    function registerInviteHandler() {
        var form = document.querySelector('form[name="invite"]')
        
        form.addEventListener('submit', function(event) {
            event.preventDefault()

            var message = form.querySelector('[name="message"]')

            var email = form.querySelector('input[name="email"]').value
            if(!email || !email.includes('@') || email.length > 254) {
                message.textContent = 'Please enter a valid email address.'
                return
            }

            message.textContent = 'Sending request...'
            fetch('/api/invite?email=' + encodeURIComponent(email) + '&teamId=' + encodeURIComponent(team.teamId), {
                method: 'POST',
                headers: {
                    Authorization: 'Bearer ' + localStorage.sessionId,
                },
            }).then(function(response) {
                if(response.ok) {
                    message.textContent = ''
                    form.querySelector('input[name="email"]').value = ''
                }
                
                else if(response.status == 409) {
                    message.textContent = 'Already invited.'
                    form.querySelector('input[name="email"]').value = ''
                    setTimeout(function() {
                        message.textContent = ''
                    }, 10000)
                }

                else if(response.status == 401) {
                    location.href = '/'
                }

                else {
                    message.textContent = 'There was an error. Please try again.'
                }
            })

            return false
        })
    }

    function updateFilesystem() {
        fetch('/api/folder?team=' + team.teamId, {
            headers: {
                Authorization: 'Bearer ' + localStorage.sessionId,
            },
        }).then(function (response) {
            if (response.ok) {
                return response.json()
            }
            
            else if(response.status == 401) {
                unAuthed()
            }
        }).then(function(data) {
            if(!data) {
                return
            }
            
            console.log('filesystem:', data)
        
            var div = document.querySelector('#left-panel')
            div.innerHTML = ''
            
            var root = document.createElement('pre')
            root.classList.add('folder')
            root.classList.add('open')
            root.textContent = '/'
            div.appendChild(root)

            if(data.length > 0) {
                root.emptyFolder = false
            } else {
                root.emptyFolder = true 
            }

            makeFolderClickable(root, '', '/')

            addFolder(root, data, '/', 0)       
        })
    }

    function addFolder(elm, folder, path, indentationLevel) {
        folder.forEach(function(entry) {
            var element = document.createElement('pre')
            elm.insertAdjacentElement('afterend', element)

            var prefix = ''
            for(var i = 0; i < indentationLevel; i++) {
                prefix += '  ';
            }

            if(entry.type == 'file') {
                element.classList.add('file')
                element.textContent = prefix + ' â‰¡ ' + entry.name
                makeFileClickable(element, path, entry.name)
            }
            
            else if(entry.type == 'folder') {
                element.classList.add('folder')
                makeFolderClickable(element, path, entry.name)

                element.contents = entry.contents
                element.indentationLevel = indentationLevel
                
                if(entry.contents.length > 0) {
                    element.emptyFolder = false
                } else {
                    element.emptyFolder = true 
                }

                if(openFolders.includes(path + entry.name + '/')) {
                    element.classList.add('open')
                    element.textContent = prefix + ' â–¼ ' + entry.name
                    addFolder(element, entry.contents, path + entry.name + '/', indentationLevel + 1)
                }
                
                else {
                    element.textContent = prefix + ' â–¶ ' + entry.name
                }
            }
        })
    }

    function createFolderView(name, path) {
        var div = document.createElement('div')
        div.style.padding = '10px'

        var h2 = document.createElement('h2')
        h2.textContent = 'ðŸ“‚ ' + path + name
        div.appendChild(h2)

        var p  = document.createElement('p')
        p.textContent = 'Upload zip and extract to folder'
        div.appendChild(p)

        var upload = document.createElement('input')
        upload.setAttribute('type', 'file')
        div.appendChild(upload)

        var uploadButton = document.createElement('button')
        uploadButton.setAttribute('type', 'click')
        uploadButton.textContent = 'Upload zip'
        div.appendChild(uploadButton)

        var message = document.createElement('p')
        div.appendChild(message)

        uploadButton.addEventListener('click', function() {
            if(upload.files[0] === undefined) {
                message.textContent = 'Choose a file first.'
                return
            }
            
            if(upload.files[0].type != 'application/zip') {
                message.textContent = 'Must be a zip file.'
                return
            }

            var fullpath
            if(path && name) {
                fullpath = path + '/' + name + '/'
            } else {
                fullpath = '/'
            }

            message.textContent = 'Uploading...'
            fetch('/api/uploadFolder?path=' + encodeURIComponent(fullpath) + '&team=' + encodeURIComponent(team.teamId), {
                method: 'POST',
                headers: {
                    Authorization: 'Bearer ' + localStorage.sessionId,
                },
                body: upload.files[0],
            }).then(function(response) {
                if(response.ok) {
                    message.textContent = 'Upload complete.'
                    console.log('File uploaded:', upload.files[0].name)
                    // location.reload() 
                }

                else if(response.status == 401) {
                    location.href = '/'
                }

                else {
                    message.textContent = "There was an error. Please try again."
                }
            })

        })

        return div
    }

    function createFileView(name, path) {
        var div = document.createElement('div')
        div.filename = name
        div.filepath = path

        var h2 = document.createElement('h2')
        h2.textContent = 'â‰¡ ' + path + name
        h2.style.padding = '10px'
        div.appendChild(h2)

        var code  = document.createElement('pre')
        code.textContent = 'Loading file...'
        code.style.fontSize = '16px'
        div.appendChild(code)

        fetch('/api/file?team=' + team.teamId + '&path=' + path + '&filename=' + name + '&syntax=true', {
            headers: {
                Authorization: 'Bearer ' + localStorage.sessionId,
            },
        }).then(function (response) {
            if (response.ok) {
                if(name.slice(-5) == '.jpeg' || name.slice(-4) == '.jpg' || name.slice(-4) == '.png') {
                    return response.blob()
                } else {
                    return response.text()
                }
            }
            
            else if(response.status == 401) {
                unAuthed()
            }
        }).then(function(data) {
            if(name.slice(-4) == '.jpg' || name.slice(-5) == '.jpeg' || name.slice(-4) == '.png') {
                code.style.display = 'none'
                var img  = document.createElement('img')
                img.src = URL.createObjectURL(data)
                div.appendChild(img)

            } else {
                code.filename = name
                code.filepath = path
                // console.log(data)
                var editor = createEditor(data)
                code.innerHTML = ''
                code.appendChild(editor)
                // addCursors(editor)
            }
            // console.log('filesystem:', data)
        })

        return div
    }

    function createEditor(input) {
        var div = document.createElement('div')
        div.classList.add('editor')
        div.innerHTML = input
        
        return div
    }

    function createEditor2(input) {
        var div = document.createElement('div')
        div.classList.add('editor')
        div.innerHTML = input

        var pre = div.querySelector('.highlight > pre')
        var nodes

        if(pre) {
            nodes = pre.childNodes
        } else {
            nodes = [div]
            pre = div
        }

        Array.from(nodes).forEach(function(node) {
            var cls
            if(node.classList) {
                cls = node.classList[0]
            } else {
                cls = 'text-node'
            }

            Array.from(node.textContent).forEach(function(char) {
                var chElm = document.createElement('pre')
                chElm.classList.add(cls)
                chElm.textContent = char
                pre.appendChild(chElm)
            })

            node.remove()
        })

        return div
    }

    function createEditor3(input) {
        var div = document.createElement('div')
        div.classList.add('editor')
        div.innerHTML = input

        var pre = div.querySelector('.highlight > pre')
        var nodes

        if(pre) {
            // Syntax highlighted
            nodes = Array.from(pre.childNodes)
        } else {
            // NOT syntax highlighted
            nodes = [div]
            pre = div
        }

        console.log('pre nodes', pre, nodes)

        nodes.forEach(function(node) {
            if(node.nodeType == 3) {
                // Text node
                var span = document.createElement('pre')
                // span.style.display = 'inline-block'
                // span.classList.add('ws')
                span.textContent = node.textContent
                // console.log(node.textContent.length, span.textContent.length)
                pre.appendChild(span)

                node.remove()
            }
        })

        return div
    }

    function addCursors(editor) {
        var cursor = 0
        var cursorInterval

        var tokens = document.querySelector('.editor .code pre').childNodes
        
        updateCursor(editor)
        
        document.addEventListener('keydown', function(event) {
            console.log(event.key)
            if(event.key == 'ArrowRight') {
                event.preventDefault()
                clearCursor(editor)
                cursor += 1
                console.log(cursor)
                if(cursor >= tokens.length) {
                    cursor = tokens.length - 1
                }
                updateCursor(editor)
            }
            
            if(event.key == 'ArrowLeft') {
                event.preventDefault()
                clearCursor(editor)
                cursor -= 1
                console.log(cursor)
                if(cursor < 0) {
                    cursor = 0
                }
                updateCursor(editor)
            }
        })
        
        function clearCursor(editor) {
            if(cursorInterval) {
                clearInterval(cursorInterval)
                var tokens = editor.querySelector('.code pre').childNodes
                var e = tokens[cursor]    
                if(e.classList) e.classList.remove('on')
            }
        }

        function updateCursor(editor) {
            if(!editor) return

            var tokens = editor.querySelector('.code pre').childNodes
            var e = tokens[cursor]
            
            e.classList.add('on')
            
            cursorInterval = setInterval(function() {
                var tokens = editor.querySelector('.code pre').childNodes
                var e = tokens[cursor]
                
                if(e.classList.contains('on')) {
                    e.classList.remove('on')
                } else {
                    e.classList.add('on')
                }
            }, 500)

            // receiveCursorMessage('steve@prospero.live', activeTab.element.path, activeTab.element.name, cursor + 1)
            Object.values(team.members).forEach(function(teammate) {
                if(teammate.online) {
                    teammate.dataChannel.send(JSON.stringify({
                        path: editor.parentElement.filepath, 
                        name: editor.parentElement.filename,
                        cursor: cursor,
                    }))
                }
            })
        }
    }

    var cursorIntervals = {}
    var otherPositions = {}
    function receiveCursorMessage(email, path, name, cursor) {
        console.log(activeTab.element.filepath, path, activeTab.element.filename, name)
        if(!(activeTab.element.filepath == path) || !(activeTab.element.filename == name)) return

        return

        console.log('here')
        var editor = activeTab.element.querySelector('.editor')

        var cursorInterval = cursorIntervals[email]

        if(cursorInterval) {
            clearInterval(cursorInterval)
            var tokens = editor.querySelector('.code pre').childNodes
            var e = tokens[otherPositions[email]]    
            if(!e.classList) e.classList.add('other')
        }
        
        cursorIntervals[email] = setInterval(function() {
            var tokens = editor.querySelector('.code pre').childNodes
            var e = tokens[cursor]
            
            if(e.classList.contains('other')) {
                e.classList.remove('other')
            } else {
                e.classList.add('other')
            }
        }, 500)
        otherPositions[email] = cursor
    }

    function removeIndented(elm) {
        var l = Array.from(elm.parentElement.children)
        var i = l.indexOf(elm) + 1
        
        while(true) {
            if(i >= l.length) break
            
            var c = l[i]

            if(getIndentationLevel(c) > getIndentationLevel(elm)) {
                c.remove()
            }

            else {
                break
            }

            i += 1
        }

        function getIndentationLevel(element) {
            return element.textContent.length - element.textContent.trim().length
        }
    }

    function makeFolderClickable(elm, path, name) {
        var fullpath
        if(path) {
            fullpath = path + name + '/'
        } else {
            fullpath = '/'
        }

        elm.addEventListener('click', function(event) {
            if(fullpath == '/') return

            if(openFolders.includes(fullpath)) {
                // closeFolder
                openFolders.splice(openFolders.indexOf(fullpath), 1)
                elm.classList.remove('open')
                elm.textContent = elm.textContent.replace('â–¼', 'â–¶')
                removeIndented(elm)
            }

            else {
                // openFolder
                openFolders.push(fullpath)
                elm.classList.add('open')
                elm.textContent = elm.textContent.replace('â–¶', 'â–¼')
                addFolder(elm, elm.contents, fullpath, elm.indentationLevel + 1)
            }
        })

        elm.addEventListener('contextmenu', function(event) {
            event.preventDefault()
            console.log('right click')

            var menu = document.querySelector('#context-menu')
            menu.innerHTML = ''
            menu.style.display = 'block'
            menu.style.left = (event.clientX + 5) + 'px'
            menu.style.top = (event.clientY + 5) + 'px'

            var p
            
            p = document.createElement('p')
            p.textContent = 'New File'
            menu.appendChild(p)

            p.addEventListener('click', function() {
                var f = document.createElement('form')
                var input = document.createElement('input')
                
                input.setAttribute('type', 'text')
                input.style.display = 'block'

                f.appendChild(input)
                elm.appendChild(f)

                input.addEventListener('blur', function() {
                    elm.removeChild(f)
                })
                
                f.addEventListener('submit', function(event) {
                    event.preventDefault()

                    var filename = input.value

                    fetch('/api/newFile?path=' + encodeURIComponent(fullpath) + '&filename=' + encodeURIComponent(filename) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                    }).then(function(response) {
                        if(response.ok) {
                        
                        }

                        else if(response.status == 401) {
                            location.href = '/'
                        }
                    })

                    return false
                })

                input.focus()
            })

            p = document.createElement('p')
            p.textContent = 'Upload File'
            menu.appendChild(p)
            
            p.addEventListener('click', function() {
                var upload = document.createElement('input')
                upload.setAttribute('type', 'file')
                upload.style.display = 'none'
                document.body.appendChild(upload)

                upload.addEventListener('change', function() {
                    if(upload.files[0] === undefined) {
                        message.textContent = 'Choose a file first.'
                        return
                    }

                    var filename = upload.files[0].name
                    
                    fetch('/api/uploadFile?path=' + encodeURIComponent(fullpath) + '&filename=' + encodeURIComponent(filename) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                        body: upload.files[0],
                    }).then(function(response) {
                        if(response.ok) {
                            // message.textContent = 'Upload complete.'
                            console.log('File uploaded:', upload.files[0].name)
                            // location.reload() 
                        }

                        else if(response.status == 401) {
                            location.href = '/'
                        }

                        else {
                            // message.textContent = "There was an error. Please try again."
                        }
                    })
                })

                upload.click()
            })

            menu.appendChild(document.createElement('hr'))

            p = document.createElement('p')
            p.textContent = 'New Folder'
            menu.appendChild(p)

            p.addEventListener('click', function() {
                var f = document.createElement('form')
                var input = document.createElement('input')
                
                input.setAttribute('type', 'text')
                input.style.display = 'block'

                f.appendChild(input)
                elm.appendChild(f)

                input.addEventListener('blur', function() {
                    elm.removeChild(f)
                })
                
                f.addEventListener('submit', function(event) {
                    event.preventDefault()

                    var filename = input.value

                    fetch('/api/newFolder?path=' + encodeURIComponent(fullpath) + '&filename=' + encodeURIComponent(filename) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                    }).then(function(response) {
                        if(response.ok) {
                        
                        }

                        else if(response.status == 401) {
                            location.href = '/'
                        }
                    })

                    return false
                })

                input.focus()
            })

            p = document.createElement('p')
            p.textContent = 'Upload folder from zip'
            menu.appendChild(p)

            p.addEventListener('click', function() {
                var upload = document.createElement('input')
                upload.setAttribute('type', 'file')
                upload.style.display = 'none'
                document.body.appendChild(upload)

                upload.addEventListener('change', function() {
                    if(upload.files[0] === undefined) {
                        message.textContent = 'Choose a file first.'
                        return
                    }
                    
                    if(upload.files[0].type != 'application/zip') {
                        message.textContent = 'Must be a zip file.'
                        return
                    }

                    console.log('path', path, 'name', name)
                    
                    var fullpath
                    
                    if(path) {
                        fullpath = path + name + '/'
                    }
                    
                    else {
                        fullpath = '/'
                    }

                    console.log('fullpath', fullpath)

                    // message.textContent = 'Uploading...'
                    fetch('/api/uploadFolder?path=' + encodeURIComponent(fullpath) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                        body: upload.files[0],
                    }).then(function(response) {
                        if(response.ok) {
                            // message.textContent = 'Upload complete.'
                            console.log('File uploaded:', upload.files[0].name)
                            // location.reload() 
                        }

                        else if(response.status == 401) {
                            location.href = '/'
                        }

                        else {
                            // message.textContent = "There was an error. Please try again."
                        }
                    })
                })

                upload.click()
            })

            // p = document.createElement('p')
            // p.textContent = 'Upload folder from git'
            // menu.appendChild(p)

            menu.appendChild(document.createElement('hr'))

            p = document.createElement('p')
            p.textContent = 'Cut'
            if(fullpath == '/') {
                p.style.color = '#888'
                p.classList.add('disabled')
            }
            menu.appendChild(p)

            p.addEventListener('click', function() {
                clipboard = {
                    type: 'folder',
                    action: 'cut',
                    path: path,
                    name: name,
                }
            })

            p = document.createElement('p')
            p.textContent = 'Copy'
            if(fullpath == '/') {
                p.style.color = '#888'
                p.classList.add('disabled')
            }
            menu.appendChild(p)

            p.addEventListener('click', function() {
                clipboard = {
                    type: 'folder',
                    action: 'copy',
                    path: path,
                    name: name,
                }
            })

            p = document.createElement('p')
            p.textContent = 'Paste'
            if(!clipboard) {
                p.style.color = '#888'
                p.classList.add('disabled')
            }
            menu.appendChild(p)

            p.addEventListener('click', function() {
                if(!clipboard) return

                console.log('clipboard', clipboard)

                if(clipboard.action == 'cut') {
                    fetch('/api/move?newPath=' + encodeURIComponent(fullpath) + '&oldPath=' + encodeURIComponent(clipboard.path) + '&filename=' + encodeURIComponent(clipboard.name) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                    }).then(function(response) {
                        if(response.status == 401) {
                            location.href = '/'
                        }
                    })
                }
                
                if(clipboard.action == 'copy' && clipboard.type == 'file') {
                    fetch('/api/copyFile?newPath=' + encodeURIComponent(fullpath) + '&oldPath=' + encodeURIComponent(clipboard.path) + '&filename=' + encodeURIComponent(clipboard.name) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                    }).then(function(response) {
                        if(response.status == 401) {
                            location.href = '/'
                        }
                    })
                }

                if(clipboard.action == 'copy' && clipboard.type == 'folder') {
                    fetch('/api/copyFolder?newPath=' + encodeURIComponent(fullpath) + '&oldPath=' + encodeURIComponent(clipboard.path) + '&filename=' + encodeURIComponent(clipboard.name) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                    }).then(function(response) {
                        if(response.status == 401) {
                            location.href = '/'
                        }
                    })
                }
            })

            menu.appendChild(document.createElement('hr'))
            
            p = document.createElement('p')
            p.textContent = 'Rename'
            if(fullpath == '/') {
                p.style.color = '#888'
                p.classList.add('disabled')
            }
            menu.appendChild(p)

            p.addEventListener('click', function() {
                var f = document.createElement('form')
                var input = document.createElement('input')
                
                input.setAttribute('type', 'text')
                input.value = name
                input.style.display = 'block'

                f.appendChild(input)
                elm.appendChild(f)

                input.addEventListener('blur', function() {
                    elm.removeChild(f)
                })
                
                f.addEventListener('submit', function(event) {
                    event.preventDefault()

                    var filename = input.value

                    fetch('/api/rename?path=' + encodeURIComponent(path) + '&newFilename=' + encodeURIComponent(filename) + '&oldFilename=' + encodeURIComponent(name) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                    }).then(function(response) {
                        if(response.status == 401) {
                            location.href = '/'
                        }
                    })

                    return false
                })

                input.focus()
            })
            
            p = document.createElement('p')
            p.textContent = 'Delete'
            if(fullpath == '/') {
                p.style.color = '#888'
                p.classList.add('disabled')
            }
            menu.appendChild(p)

            p.addEventListener('click', function() {
                fetch('/api/deleteFolder?path=' + encodeURIComponent(path) + '&filename=' + encodeURIComponent(name) + '&team=' + encodeURIComponent(team.teamId), {
                    method: 'POST',
                    headers: {
                        Authorization: 'Bearer ' + localStorage.sessionId,
                    },
                }).then(function (response) {
                    if (response.ok) {
                        
                    }
                    
                    else if(response.status == 401) {
                        location.href = '/'
                    }
                })
            })
            
            menu.appendChild(document.createElement('hr'))
            
            p = document.createElement('p')
            p.textContent = 'Download as zip'
            if(elm.emptyFolder) {
                p.style.color = '#888'
                p.classList.add('disabled')
            }
            menu.appendChild(p)
            
            p.addEventListener('click', function() {
                fetch('/api/downloadFolder?path=' + encodeURIComponent(path) + '&filename=' + encodeURIComponent(name) + '&team=' + encodeURIComponent(team.teamId), {
                    method: 'GET',
                    headers: {
                        Authorization: 'Bearer ' + localStorage.sessionId,
                    },
                })
                .then(function (response) {
                    if(response.ok) {
                        return response.blob()
                    }

                    else if(response.status == 401) {
                        location.href = '/'
                    }
                })
                .then(function(blob) {
                    var url = URL.createObjectURL(blob)
                    var a = document.createElement('a')
                    a.href = url
                    if(path) {
                        a.download = name + '.zip'
                    } else {
                        a.download = 'team-' + shortTeamId + '.zip'
                    }
                    document.body.appendChild(a)
                    a.click()    
                    a.remove()
                })
            })

            var offscreenAmount = (menu.clientHeight + event.clientY + 15) - window.innerHeight
            if(offscreenAmount > 0) {
                menu.style.top = (event.clientY + 5 - offscreenAmount) + 'px'
            }

            document.body.addEventListener('click', function(event) {
                if(event.target != menu) {
                    menu.innerHTML = ''
                    menu.style.display = 'none'
                }
            })

        })
    }

    function makeFileClickable(elm, path, name) {
        elm.addEventListener('click', function() {
            // var fileView = createFileView(name, path)
            // var fileView = createFileEditorView(name, path)
            var fileView = createFileView(name, path)

            var tab = addTab('â‰¡ ' + name + ' in ' + path, fileView)

            switchTab(tab)
        })


        elm.addEventListener('contextmenu', function(event) {
            event.preventDefault()

            var menu = document.querySelector('#context-menu')
            menu.innerHTML = ''
            menu.style.display = 'block'
            menu.style.left = (event.clientX + 5) + 'px'
            menu.style.top = (event.clientY + 5) + 'px'
            
            var p
            
            p = document.createElement('p')
            p.textContent = 'Replace'
            menu.appendChild(p)
            
            p.addEventListener('click', function() {
                var upload = document.createElement('input')
                upload.setAttribute('type', 'file')
                upload.style.display = 'none'
                document.body.appendChild(upload)

                upload.addEventListener('change', function() {
                    if(upload.files[0] === undefined) {
                        message.textContent = 'Choose a file first.'
                        return
                    }

                    console.log('path', path, 'name', name)

                    // message.textContent = 'Uploading...'
                    fetch('/api/uploadFile?path=' + encodeURIComponent(path) + '&filename=' + encodeURIComponent(name) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                        body: upload.files[0],
                    }).then(function(response) {
                        if(response.ok) {
                            // message.textContent = 'Upload complete.'
                            console.log('File uploaded:', upload.files[0].name)
                            // location.reload() 
                        }

                        else if(response.status == 401) {
                            location.href = '/'
                        }

                        else {
                            // message.textContent = "There was an error. Please try again."
                        }
                    })
                })

                upload.click()
            })

            menu.appendChild(document.createElement('hr'))
            
            p = document.createElement('p')
            p.textContent = 'Cut'
            menu.appendChild(p)
            
            p.addEventListener('click', function() {
                clipboard = {
                    type: 'file',
                    action: 'cut',
                    path: path,
                    name: name,
                }
            })

            p = document.createElement('p')
            p.textContent = 'Copy'
            menu.appendChild(p)
            
            p.addEventListener('click', function() {
                clipboard = {
                    type: 'file',
                    action: 'copy',
                    path: path,
                    name: name,
                }
            })

            menu.appendChild(document.createElement('hr'))
            
            p = document.createElement('p')
            p.textContent = 'Rename'
            menu.appendChild(p)
            
            p.addEventListener('click', function() {
                var f = document.createElement('form')
                var input = document.createElement('input')
                
                input.setAttribute('type', 'text')
                // input.setAttribute('placeholder', name)
                input.value = name
                input.style.display = 'block'

                f.appendChild(input)
                elm.appendChild(f)

                input.addEventListener('blur', function() {
                    elm.removeChild(f)
                })
                
                f.addEventListener('submit', function(event) {
                    event.preventDefault()

                    var filename = input.value

                    fetch('/api/rename?path=' + encodeURIComponent(path) + '&newFilename=' + encodeURIComponent(filename) + '&oldFilename=' + encodeURIComponent(name) + '&team=' + encodeURIComponent(team.teamId), {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer ' + localStorage.sessionId,
                        },
                    }).then(function(response) {
                        if(response.status == 401) {
                            location.href = '/'
                        }
                    })

                    return false
                })

                input.focus()
            })

            p = document.createElement('p')
            p.textContent = 'Delete'
            menu.appendChild(p)

            p.addEventListener('click', function() {
                fetch('/api/deleteFile?path=' + encodeURIComponent(path) + '&filename=' + encodeURIComponent(name) + '&team=' + encodeURIComponent(team.teamId), {
                    method: 'POST',
                    headers: {
                        Authorization: 'Bearer ' + localStorage.sessionId,
                    },
                }).then(function (response) {
                    if(response.status == 401) {
                        location.href = '/'
                    }
                })
            })

            menu.appendChild(document.createElement('hr'))
            
            p = document.createElement('p')
            p.textContent = 'Download'
            menu.appendChild(p)

            p.addEventListener('click', function() {
                fetch('/api/downloadFile?path=' + encodeURIComponent(path) + '&filename=' + encodeURIComponent(name) + '&team=' + encodeURIComponent(team.teamId), {
                    method: 'GET',
                    headers: {
                        Authorization: 'Bearer ' + localStorage.sessionId,
                    },
                })
                .then(function (response) {
                    if(response.ok) {
                        return response.blob()
                    }

                    else if(response.status == 401) {
                        location.href = '/'
                    }
                })
                .then(function(blob) {
                    var url = URL.createObjectURL(blob)
                    var a = document.createElement('a')
                    a.href = url
                    a.download = name
                    document.body.appendChild(a)
                    a.click()    
                    a.remove()
                })
            })

            var offscreenAmount = (menu.clientHeight + event.clientY + 15) - window.innerHeight
            if(offscreenAmount > 0) {
                menu.style.top = (event.clientY + 5 - offscreenAmount) + 'px'
            }

            document.body.addEventListener('click', function(event) {
                if(event.target != menu) {
                    menu.innerHTML = ''
                    menu.style.display = 'none'
                }
            })

        })
    }

    function closeTab(tab) {
        if(tab) {
            var selected = false
            if(Array.from(tab.classList).includes('selected')) {
                selected = true
            }
            
            tab.element.remove()
            tab.remove()

            if(selected && document.querySelector('#tabs').children.length > 0) {
                switchTab(document.querySelector('#tabs').children[0])    
            }
        }

        updateTabCount()
    }

    function addTab(name, element, replace) {
        var alreadyOpen = false

        var tabs = document.querySelector('#tabs')
        tabs.querySelectorAll('div').forEach(function(tab) {
            if(tab.name == name) {
                alreadyOpen = tab
            }
        })

        if(alreadyOpen) {
            return alreadyOpen
        }

        var tab = document.createElement('div')
        
        var span = document.createElement('span')
        span.textContent = name

        var closeButton = document.createElement('a')
        closeButton.textContent = 'x'
        closeButton.style.color = '#888'

        closeButton.addEventListener('click', function(event) {
            event.preventDefault()
            event.stopPropagation()

            closeTab(tab)

            return false
        })

        
        tab.appendChild(span)
        tab.appendChild(closeButton)

        tab.name = name

        var tabs = document.querySelector('#tabs')
        // tabs.appendChild(tab)
        tabs.insertBefore(tab, tabs.firstChild)

        tab.addEventListener('click', function() {
            switchTab(tab)
        })

        tab.element = element

        var mainView = document.querySelector('#main-view')
        tab.element.style.display = 'none'
        mainView.appendChild(tab.element)

        updateTabCount()

        return tab
    }

    function updateTabCount() {
        var tabs = document.querySelector('#tabs')
        var tab = tabs.querySelector('div')

        if(tabs.scrollWidth > tabs.clientWidth) {
            var numOffscreenElements = Math.ceil((tabs.scrollWidth - tabs.clientWidth) / tab.offsetWidth)
            document.querySelector('#more-tabs span').textContent = numOffscreenElements.toString()
            document.querySelector('#more-tabs').style.display = 'block'
        } else {
            document.querySelector('#more-tabs').style.display = 'none'
        }
    }

    var activeTab
    function switchTab(tab) {
        var tabs = document.querySelector('#tabs')
        tabs.querySelectorAll('div').forEach(function(t) {
            t.classList.remove('selected')
            t.element.style.display = 'none'
        })

        tab.classList.add('selected')
        tab.element.style.display = 'block'

        activeTab = tab
    }

    var firstClick = false
    window.addEventListener('click', function() {
        firstClick = true
        if(team) {
            Object.values(team.members).forEach(function(peer) {
                var peerElement = peer.peerElement
                if(peerElement !== undefined) {
                    var peerCameraElement = peerElement.querySelector('[name="camera"]')
                    peerCameraElement.muted = false
                }
            })
        }
    })

    function getUser(done) {
        fetch('/api/user', {
            headers: {
                Authorization: 'Bearer ' + localStorage.sessionId,
            },
        }).then(function (response) {
            if (response.ok) {
                return response.json()
            }
            
            else {
                unAuthed()
            }
        }).then(function(data) {
            user = data
            team = getTeam(shortTeamId)

            if(!user) {
                return
            }
            
            console.log('user:', user)
            
            done()
        })
    }

    window.addEventListener('DOMContentLoaded', function (event) {
        getUser(function() {
            loadPage()
        })
        
    })

    function unAuthed() {
        location.href = '/'
        // document.querySelector('header [name="email"]').textContent = 'You are not logged in.'
    }

    var user
    var yourEmail
    
    var shortTeamId = location.search.split('id=')[1].slice(0, 4)
    var team

    var webSocket

    var localVideoStream
    var localScreenStream

    var colors = ['#3f3', '#33f', '#f3f', '#ff3', '#f33', '#3ff', '#afa']
    var colorCursor = 0

    function loadPage() {
        yourEmail = user.email
        
        document.querySelector('[name="your-email"]').textContent = user.email
        
        // document.querySelector('header [name="email"]').textContent = user.email
        // document.title = 'Collaborating | Aurifex Labs'
        // document.querySelector('h1').textContent = 'Team ' + shortTeamId


        updateOfflineList()
        updateInvitedList()

        document.querySelector('button[name="share-video"]').addEventListener('click', function() {
            document.querySelector('[name="local-video"]').style.display = 'inline'
            shareVideo()
            // document.querySelector('button[name="share-video"]').style.fontSize = '50%'
            // document.querySelector('button[name="share-video"]').style.padding = '3px'
            document.querySelector('button[name="share-video"]').style.display = 'none'
        })
        
        document.querySelector('button[name="share-screen"]').addEventListener('click', function() {
            document.querySelector('[name="local-screen"]').style.display = 'inline'
            shareScreen()    
            // document.querySelector('button[name="share-screen"]').style.fontSize = '50%'
            // document.querySelector('button[name="share-screen"]').style.padding = '3px'
        })

        registerInviteHandler()

        connect()

        setInterval(function () {
            if(webSocket === undefined || webSocket.readyState == WebSocket.CLOSED) {
                connect()
            }
       
            else if (webSocket.readyState == WebSocket.OPEN) {
                webSocket.send(JSON.stringify({
                    type: 'ping',
                    time: Date.now(),
                }))
            }
        }, 1 * 1000)
    }

    function connect() {
        console.log('connect')

        var statusElement = document.querySelector('#status-bar')
        statusElement.textContent = 'Connecting...'

        var webSocketProtocol = 'wss:'
        if(location.protocol == 'http:') {
            webSocketProtocol = 'ws:'
        } 

        webSocket = new WebSocket(webSocketProtocol + '//' + location.host)
        
        webSocket.addEventListener('open', function (event) {
            statusElement.textContent = 'Connected.'

            var message = {
                type: 'authorization',
                authorization: 'Bearer ' + localStorage.sessionId,
                team: shortTeamId, 
            }

            webSocket.send(JSON.stringify(message))
        })

        webSocket.addEventListener('message', function (event) {
            var message = JSON.parse(event.data)
            // console.log(message)

            if(message.type == 'pong') {
                var latency = Math.ceil((Date.now() - message.pingTime) / 2)
                // console.log('Latency:', latency + 'ms')
                document.querySelector('#status-bar').textContent = 'Connected to server - ' + latency + 'ms'
            }

            if(message.type == 'authenticated') {
                message.onlineTeam.forEach(function(email) {
                    if(email == user.email) return

                    console.log(team)
                    team.members[email].online = true
                    if(!team.members[email].peerElement) {
                        team.members[email].peerElement = addPeerElement(email)
                    }

                    if(localVideoStream) {
                        team.members[email].peerConnections.toVideo = call(email, 'toVideo')
                    }
                    if(localScreenStream) {
                        team.members[email].peerConnections.toScreen = call(email, 'toScreen')
                    }
                })

                updateOfflineList()
                updateInvitedList()
                updateFilesystem()
            }

            if(message.type == 'filesystem-changed') {
                updateFilesystem()
            }

            if(message.type == 'team-changed') {
                getUser(function() {
                    updateOfflineList()
                    updateInvitedList()
                })
            }

            if(message.type == 'joined') {
                var email = message.email
                
                team.members[email].online = true  

                if(!team.members[email].peerElement) {
                    team.members[email].peerElement = addPeerElement(email)
                }

                team.members[email].peerConnections.data = call(email, 'data')

                if(localVideoStream) {
                    team.members[email].peerConnections.toVideo = call(email, 'toVideo')
                }
                if(localScreenStream) {
                    team.members[email].peerConnections.toScreen = call(email, 'toScreen')
                }

                updateOfflineList()
            }
            
            if(message.type == 'left') {
                var email = message.email
                team.members[email].online = false

                if(team.members[email].peerElement) {
                    var cameraElement = team.members[email].peerElement.querySelector('[name="camera"]')
                    if(cameraElement) {
                        closeTab(cameraElement.mainVideoTab)
                    }
                    
                    var screenElement = team.members[email].peerElement.querySelector('[name="screen"]')
                    if(screenElement) {
                        closeTab(screenElement.mainVideoTab)
                    }

                    team.members[email].peerElement.remove()
                    delete team.members[email].peerElement
                }

                team.members[email].peerConnections = {}
                delete team.members[email].dataChannel

                updateOfflineList()
            }

            else if(message.type == 'iceCandidate') {
                var candidate = new RTCIceCandidate(message.candidate)

                var peer = team.members[message.from]
                
                if(peer.peerConnections[message.channel]) {
                    var peerConnection = peer.peerConnections[message.channel]
                    peerConnection.addIceCandidate(candidate)
                    
                    if(!peer.peerConnections[message.channel].remoteDescription) {
                        console.log('got ice message too early: no remoteDescription')
                    }
                }
                
                else {
                    console.log('got ice message too early: no peerConnection')
                }
            }
            
            else if(message.type == 'answer') {
                var peer = team.members[message.from]
                var sessionDescription = new RTCSessionDescription(message.answer)
                var peerConnection = peer.peerConnections[message.channel]
                peerConnection.setRemoteDescription(sessionDescription)
            }
            
            else if(message.type == 'offer') {
                var toEmail = message.from
                var peer = team.members[message.from]
                
                var peerConnection = createPeerConnection(toEmail, message.channel)
                peer.peerConnections[message.channel] = peerConnection

                var sessionDescription = new RTCSessionDescription(message.offer)

                peerConnection.setRemoteDescription(sessionDescription)
                .then(function() {
                    return peerConnection.createAnswer()
                })
                .then(function(answer) {
                    return peerConnection.setLocalDescription(answer)
                })
                .then(function() {
                    webSocket.send(JSON.stringify({
                        type: 'answer',
                        answer: peerConnection.localDescription,
                        to: toEmail,
                        from: yourEmail,
                        channel: reverseChannel(message.channel),
                    }))
                })
            }
        })

        webSocket.addEventListener('error', function (event) {
            statusElement.textContent = 'Disconnected. Trying to reconnect...'
            console.log('webSocket error:', event)
            closeWebSocket()
        })
        
        webSocket.addEventListener('close', function (event) {
            statusElement.textContent = 'Disconnected. Trying to reconnect...'
            console.log('webSocket closed:', event)
            closeWebSocket()
        })
    }

    function closeWebSocket() {
        Object.values(team.members).forEach(function(peer) {
            if(peer.peerElement) {
                peer.peerElement.remove()
                delete peer.peerElement
            }

            peer.online = false

            peer.peerConnections = {}
            delete peer.dataChannel
        })

        updateOfflineList()
    }

    function shareVideo() {
        navigator.mediaDevices.getUserMedia({
            audio: {
                autoGainControl: true,
                echoCancellation: true,
                noiseSuppression: true,
            },
            video: {
                width: 400,
                height: 225,
            },
        }).then(function(localStream) {
            localVideoStream = localStream

            var tabName = 'Camera (yours)'

            var localVideo = document.querySelector('video[name="local-video"]')
            localVideo.addEventListener('click', function() {
                var video
                if(!localVideo.mainVideo) {
                    video = document.createElement('video')
                    video.autoplay = true
                    video.muted = true
                    localVideo.mainVideo = video
                } else {
                    video = localVideo.mainVideo
                }

                var tab = addTab(tabName, video)
                // updateTab(tabName, video)
                switchTab(tab)

                video.srcObject = localStream
            })

            localVideo.srcObject = localStream

            if(localVideo.mainVideo) {
                localVideo.mainVideo.srcObject = localStream
                // updateTab(tabName, video)
            }
            

            Object.values(team.members).forEach(function(peer) {
                if(peer.online) {
                    peer.peerConnections.toVideo = call(peer.email, 'toVideo')
                }
            })
        })
        .catch(function(error) {
            console.log(error)
        })
    }

    function shareScreen() {
        navigator.mediaDevices.getDisplayMedia({
            video: {
                width: 1600,
                height: 900,
            }
        })
        .then(function(localStream) {
            localScreenStream = localStream

            var tabName = 'Screen (yours)'

            var localScreen = document.querySelector('video[name="local-screen"]')        
            // var video
            localScreen.addEventListener('click', function() {
                var video
                if(!localScreen.mainVideo) {
                    video = document.createElement('video')
                    video.autoplay = true
                    video.muted = true
                    localScreen.mainVideo = video
                } else {
                    video = localScreen.mainVideo
                }

                var tab = addTab(tabName, video)
                // updateTab(tabName, video)
                switchTab(tab)

                video.srcObject = localStream
            })
            
            localScreen.srcObject = localStream

            if(localScreen.mainVideo) {
                localScreen.mainVideo.srcObject = localStream
                // updateTab(tabName, video)
            }
            
            
            Object.values(team.members).forEach(function(peer) {
                if(peer.online) {
                    peer.peerConnections.toScreen = call(peer.email, 'toScreen')
                }
            })
        })
        .catch(function(error) {
            console.log(error)
        })
    }

    function reverseChannel(channel) {
        if(channel == 'toVideo') return 'fromVideo'
        if(channel == 'toScreen') return 'fromScreen'    
        if(channel == 'fromVideo') return 'toVideo'
        if(channel == 'fromScreen') return 'toScreen'    
        if(channel == 'data') return 'data'    
    }

    function addPeerElement(toEmail) {
        var peerElement

        var color = colors[colorCursor]
        colorCursor += 1
        if(colorCursor >= colors.length) {
            colorCursor = 0
        }

        peerElement = document.createElement('div')
        peerElement.style.borderRadius = '10px'
        peerElement.style.border = 'solid 5px ' + color
        peerElement.style.margin = '5px'
        peerElement.style.backgroundColor = '#fff'
        
        var p = document.createElement('p')
        p.textContent = toEmail
        p.style.margin = '0'
        p.style.paddingLeft = '3px'
        p.style.borderBottom = 'solid 1px #ddd'
        p.style.overflow = 'hidden'
        p.style.whiteSpace = 'nowrap'
        peerElement.appendChild(p)

        var l = document.createElement('p')
        l.textContent = ''
        l.style.margin = '0'
        l.style.paddingLeft = '3px'
        l.classList.add('latency')
        // p.style.borderBottom = 'solid 1px #ddd'
        // p.style.overflow = 'hidden'
        // p.style.whiteSpace = 'nowrap'
        peerElement.appendChild(l)
        
        var peerVideoElement = document.createElement('video')
        peerVideoElement.setAttribute('name', 'camera')
        peerVideoElement.style.display = 'none'
        peerVideoElement.autoplay = true
        if(!firstClick) {
            peerVideoElement.muted = true
        }
        // peerVideoElement.style.borderBottom = 'solid 1px ' + color
        peerElement.appendChild(peerVideoElement)
        
        peerVideoElement.addEventListener('click', function() {
            var video = document.createElement('video')
            video.autoplay = true
            video.muted = true
            peerVideoElement.mainVideo = video

            var tabName = 'Camera (' + toEmail + ')'
            var tab = addTab(tabName, video)
            // updateTab(tabName, video)
            switchTab(tab)

            peerVideoElement.mainVideoTab = tab

            video.srcObject = peerVideoElement.srcObject
        })

        var peerScreenElement = document.createElement('video')
        peerScreenElement.setAttribute('name', 'screen')
        peerScreenElement.style.display = 'none'
        peerScreenElement.autoplay = true
        peerScreenElement.muted = true
        peerElement.appendChild(peerScreenElement)

        peerScreenElement.addEventListener('click', function() {
            var video = document.createElement('video')
            video.autoplay = true
            video.muted = true
            peerScreenElement.mainVideo = video

            var tabName = 'Screen (' + toEmail + ')'
            var tab = addTab(tabName, video)
            // updateTab(tabName, video)
            switchTab(tab)

            peerScreenElement.mainVideoTab = tab

            video.srcObject = peerScreenElement.srcObject
        })

        var offlineList = document.querySelector('#offline')
        document.querySelector('#right-panel').insertBefore(peerElement, offlineList)

        return peerElement
    }

    function createPeerConnection(toEmail, channel) {
        var peer = team.members[toEmail]

        var peerConnection = new RTCPeerConnection({
            iceServers: [{
                urls: ["stun:aurifexlabs.com:3478", 'turn:aurifexlabs.com:3478' ],
                username: 'username2',
                credential: 'oGtata8EdBtFhQUc',
            }]
        })
                
        peerConnection.onicecandidate = function(event) {
            if(event.candidate) {
                webSocket.send(JSON.stringify({
                    type: 'iceCandidate',
                    candidate: event.candidate,
                    to: toEmail,
                    from: yourEmail,
                    channel: reverseChannel(channel),
                }))
            }
        }

        peerConnection.ontrack = function(event) {
            console.log('ontrack', toEmail, event.streams)
            console.log('ontrack channel', channel)

            var videoElement
            // var tabName

            if(channel == 'fromVideo') {
                videoElement = team.members[toEmail].peerElement.querySelector('[name="camera"]')
                // tabName = 'Camera (' + toEmail + ')'
            }
            if(channel == 'fromScreen') {
                videoElement = team.members[toEmail].peerElement.querySelector('[name="screen"]')
                // tabName = 'Screen (' + toEmail + ')'
            }

            videoElement.srcObject = event.streams[0]
            videoElement.style.display = 'inline'

            if(videoElement.mainVideo) {
                videoElement.mainVideo.srcObject = event.streams[0]
            }
            // updateTab(tabname, videoElement.mainVideo)
        }

        peerConnection.ondatachannel = function(event) {
            var dataChannel = event.channel
            team.members[toEmail].dataChannel = dataChannel
            
            dataChannel.onopen = function(event) {
                console.log('dataChannel opened from', toEmail)

                setInterval(function () {
                    dataChannel.send(JSON.stringify({
                        type: 'ping',
                        time: Date.now(),
                    }))
                }, 1 * 1000)
            }

            dataChannel.onmessage = function(event) {
                console.log('dataChannel message from', toEmail + ':', event.data)

                var message = JSON.parse(event.data)
                
                if(message.type == 'ping') {
                    dataChannel.send(JSON.stringify({
                        type: 'pong',
                        pingTime: message.time,
                        time: Date.now(),
                    }))
                }

                if(message.type == 'pong') {
                    var latency = Math.ceil((Date.now() - message.pingTime) / 2)
                    console.log('Latency:', latency + 'ms')
                    // document.querySelector('#status-bar')
                    var l = team.members[toEmail].peerElement.querySelector('.latency')
                    l.textContent = latency + 'ms'
                }

                // receiveCursorMessage(toEmail, message.path, message.name, message.cursor)
            }
        }

        return peerConnection
    }
    
    function call(toEmail, channel) {
        console.log('call', toEmail, channel)
        var peerConnection = createPeerConnection(toEmail, channel)

        peerConnection.onnegotiationneeded = function(event) {
            peerConnection.createOffer()
            .then(function(offer) {
                return peerConnection.setLocalDescription(offer)
            })
            .then(function() {
                console.log('send offer')
                webSocket.send(JSON.stringify({
                    type: 'offer',
                    offer: peerConnection.localDescription,
                    to: toEmail,
                    from: yourEmail,
                    channel: reverseChannel(channel),
                }))
            })
        }

        if(channel == 'toVideo') {
            localVideoStream.getTracks().forEach(function(track) {
                peerConnection.addTrack(track, localVideoStream)
            })
        }

        if(channel == 'toScreen') {
            localScreenStream.getTracks().forEach(function(track) {
                peerConnection.addTrack(track, localScreenStream)
            })
        }

        if(channel == 'data') {
            var dataChannel = peerConnection.createDataChannel('data')
            team.members[toEmail].dataChannel = dataChannel

            dataChannel.onopen = function(event) {
                console.log('dataChannel opened to', toEmail)

                setInterval(function () {
                    dataChannel.send(JSON.stringify({
                        type: 'ping',
                        time: Date.now(),
                    }))
                }, 1 * 1000)
            }

            dataChannel.onmessage = function(event) {
                console.log('dataChannel message from', toEmail + ':', event.data)
            
                var message = JSON.parse(event.data)
                
                if(message.type == 'ping') {
                    dataChannel.send(JSON.stringify({
                        type: 'pong',
                        pingTime: message.time,
                        time: Date.now(),
                    }))
                }

                if(message.type == 'pong') {
                    var latency = Math.ceil((Date.now() - message.pingTime) / 2)
                    console.log('Latency:', latency + 'ms')
                    // document.querySelector('#status-bar')
                    var l = team.members[toEmail].peerElement.querySelector('.latency')
                    l.textContent = latency + 'ms'
                }
            }
        }

        return peerConnection
    }

    function getTeam(shortTeamId) {
        var result = null


        user.teams.forEach(function(t) {
            var teamId = t.teamId
            if(teamId.slice(0, 4) == shortTeamId) {
                result = t
            }
        })

        var teamObject = {}
        result.members.forEach(function(email) {
            if(user.email != email) {
                teamObject[email] = {
                    email: email,
                    online: false,
                    peerConnections: {},
                }
            }
        })

        result.members = teamObject

        return result
    }

    function updateOfflineList() {
        var offlineList = document.querySelector('#offline')
        offlineList.innerHTML = '<p name="title" style="font-size: 75%; margin: 1px; text-decoration: underline;">Offline</p>'

        var anyOffline = false
        Object.values(team.members).forEach(function(peer) {
            if(!peer.online) {
                var p = document.createElement('p')
                p.textContent = peer.email
                p.style.margin = '3px'
                p.style.overflow = 'hidden'
                p.style.whiteSpace = 'nowrap'
                offlineList.appendChild(p)
                anyOffline = true
            }
        })

        if(!anyOffline) {
            offlineList.querySelector('[name="title"]').style.display = 'none' 
        }
    }

    function updateInvitedList() {
        var l = document.querySelector('#invited')
        l.innerHTML = '<p name="title" style="font-size: 75%; margin: 1px; text-decoration: underline;">Invited</p>'

        if(team.invited.length > 0) {
            Object.values(team.invited).forEach(function(peer) {
                var p = document.createElement('p')
                p.textContent = peer
                p.style.margin = '3px'
                p.style.overflow = 'hidden'
                p.style.whiteSpace = 'nowrap'
                l.appendChild(p)
                anyInvited = true
            })
        }

        else {
            l.querySelector('[name="title"]').style.display = 'none' 
        }
    }
</script>

</body>
</html>
        